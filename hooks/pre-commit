#!/usr/bin/env bash

set -euo pipefail

GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "${REPO_ROOT}"

if [[ ! -x ./check_format.sh ]]; then
    echo -e "${YELLOW}Warning: ./check_format.sh is missing or not executable.${NC}"
    echo -e "${YELLOW}Skipping formatting check.${NC}"
    exit 0
fi

if ./check_format.sh; then
    echo -e "${GREEN}Formatting check passed.${NC}"
    exit 0
fi

status=$?

echo -e "${RED}Formatting issues detected.${NC}"
echo -e "${YELLOW}Run ./format.sh (or clang-format) to address the problems, then restage your changes.${NC}"
exit "${status}"
